# Authentication

::: tip
There is a permission system for each model, so we have to authenticate the user before we access the data.
:::

We use **JWT** (json Web Token) to authenticate the user. The token is generated by the server and sent back to the client. The client can then send the token in 2 ways: in the `Authorization` header or in the `token` cookie.

```
Authorization: Bearer <token>
```
```
Cookie: token=<token>
```

## Register
To register a new user, you can use the following request:

`POST /api/register`

**Request Body**
```json
{
    "username": "required, length 3-20",
    "password": "required, length 3-20"
}
```
**Response Body**
```json
{
    "code": 200, // 200 for success and 400 for error.
    "msg": "注册成功",
}
```

Then the information will be stored in the builtin SQLite database, with password hashed.

## Login
Authenticate as a user.

`POST /api/login`
**Request Body**
```json
{
    "username": "required",
    "password": "required"
}
```

**Response Body**

```json
//When fails:
{
    "code": 400,
    "msg": "用户名或密码错误",
}

//When success:
// Set-Cookie: token=<token>
{
    "code": 200,
    "msg": "登录成功",
    "data": {
        "token": "<token>",
        "user": {
            "id": 114514,
            "username": "username",
            "password": "hashed",
            "lastontime": "2024-10-04 13:17:52", //last login time
            "role": "user"
        }
    }
}
```

## Permissions and Roles

Be careful to distinct between model permissions and field permissions.
:::tip
**Model Permissions**
- **C** : Creating items.
- **RO** : Reading one item.
- **RL** : Reading more than 1 items.
- **R** : Short for both `RO` and `RL`.
- **U** : Updating items.
- **D** : Deleting items.
:::

:::tip
**Field Permissions**
- **r** : Reading field value, used when reading an item.
- **w** : Writing field value, used when updating an item. (Creating not influnced)
- **p** : Populating field value, used when reading an item.
:::

You can define each permission in your role, but there are two builtin roles.
- **PUBLIC** : means unlogined user. You can define permission for this role.
- **DEFAULT** : If no role matched, this role will be used. You can define permission for this role. By default, it is `C,R,U,D` model permissions and `r,w,p` field permissions, which can be set in [Global Settings](../developing/globalSettings.md)

